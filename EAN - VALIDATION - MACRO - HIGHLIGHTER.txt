Sub ValidateAndHighlight()
    Dim ws As Worksheet
    Dim lastRow As Long
    Dim eanRange As Range
    Dim cell As Range
    Dim columnLetter As String
    
    ' Prompt the user to enter the column letter
    columnLetter = InputBox("Enter the column letter containing EAN codes (e.g., A, B, C)", "Column Selection")
    
    ' Check if the entered column letter is valid
    If Not IsValidColumn(columnLetter) Then
        MsgBox "Invalid column letter. Exiting macro."
        Exit Sub
    End If
    
    ' Set the active sheet
    Set ws = ActiveSheet
    
    ' Find the last row in the selected column
    lastRow = ws.Cells(ws.Rows.Count, columnLetter).End(xlUp).Row
    
    ' Set the range of EAN codes
    Set eanRange = ws.Range(columnLetter & "2:" & columnLetter & lastRow)
    
    ' Loop through each cell in the range
    For Each cell In eanRange
        ' Skip blank cells
        If Not IsEmpty(cell) Then
            Dim ean As String
            ean = CStr(cell.Value)
            
            ' Check validity of EAN
            If IsValidEAN(ean) Then
                ' Add leading zeros to make it 13 digits if necessary
                Dim newEAN As String
                newEAN = WorksheetFunction.Rept("0", 13 - Len(ean)) & ean
                
                ' If new EAN is still valid after padding, update the value
                If IsValidEAN(newEAN) Then
                    cell.Value = newEAN
                Else
                    HighlightCell cell
                End If
            Else
                HighlightCell cell
            End If
        End If
    Next cell
End Sub

Function IsValidEAN(ByVal ean As String) As Boolean
    ' Check if the EAN is valid based on given conditions
    If IsNumeric(ean) And Len(ean) <= 13 And _
       Left(ean, 1) <> "2" And _
       Mid(ean, 1, 3) <> "000" And _
       Mid(ean, 3, 5) <> "00000" And _
       Mid(ean, 8, 5) <> "00000" Then
        IsValidEAN = True
    Else
        IsValidEAN = False
    End If
End Function

Sub HighlightCell(ByRef cell As Range)
    ' Highlight the invalid cell with Blue color and white font
    With cell.Interior
        .Pattern = xlSolid
        .Color = RGB(0, 176, 240) ' Blue background color (#00B0F0)
    End With
    With cell.Font
        .Color = RGB(255, 255, 255) ' White text color
    End With
End Sub

Function IsValidColumn(ByVal columnLetter As String) As Boolean
    ' Check if the column letter is between A and XFD (the last column)
    If Len(columnLetter) = 1 And columnLetter Like "[A-Za-z]" Then
        IsValidColumn = True
    Else
        IsValidColumn = False
    End If
End Function
